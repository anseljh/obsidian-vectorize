# Obsidian Vectorize Plugin

## Overview
Vectorize is an Obsidian plugin that enables semantic search across your notes using vector embeddings. It uses Ollama (running locally) to generate embeddings from note content and stores them in a Milvus vector database for fast similarity searches.

**Project Type:** Obsidian Plugin Development (TypeScript)
**Build System:** esbuild
**Package Manager:** npm
**Current State:** Fully implemented and ready for use

## Recent Changes
- **2025-10-26**: Complete Vectorize plugin implementation
  - Integrated Ollama client for embedding generation
  - Integrated Milvus SDK for vector storage and similarity search
  - Implemented all core commands and features
  - Added comprehensive settings UI
  - Fixed critical issues with Milvus address format
  - Configured esbuild with platform: 'node' for Node.js dependencies

## Plugin Features

### Core Functionality
1. **Embedding Generation**: Uses Ollama to generate vector embeddings from note content
2. **Vector Storage**: Stores embeddings in Milvus vector database with metadata
3. **Similarity Search**: Find notes similar to the current note or custom queries
4. **Vector Management**: Refresh modified notes or recompute all vectors

### Commands
- **Find similar notes to current note**: Analyzes the active note and displays similar notes
- **Query similar notes**: Opens a dialog to search for notes similar to custom text
- **Refresh vectors for modified notes**: Updates embeddings only for notes that changed
- **Recompute vectors for all notes**: Rebuilds the entire vector database

### Settings
- **Ollama Model**: Which model to use for embeddings (default: nomic-embed-text)
- **Milvus Address**: Host and port of Milvus server (default: localhost:19530)
- **Collection Name**: Name of the Milvus collection (default: obsidian_notes)

## Project Architecture

### File Structure
- `main.ts` - Plugin implementation with all features
- `main.js` - Compiled plugin (generated by esbuild)
- `manifest.json` - Plugin metadata
- `package.json` - Dependencies and scripts
- `esbuild.config.mjs` - Build configuration with Node.js platform
- `tsconfig.json` - TypeScript compiler configuration

### Dependencies
- `ollama` - Client for Ollama API
- `@zilliz/milvus2-sdk-node` - Milvus vector database SDK
- `obsidian` - Obsidian API types and interfaces

### Build Process
- **Development**: `npm run dev` - Watches for changes and auto-compiles
- **Production**: `npm run build` - Type-checks and builds minified version
- **Platform**: Configured for Node.js (required for Ollama and Milvus clients)

## Usage Instructions

### Prerequisites
Before using this plugin, you need:
1. **Ollama** running locally on `http://localhost:11434`
2. **Milvus** vector database running on `localhost:19530`
3. The **nomic-embed-text** model installed in Ollama (or configure a different model)

### Installation
1. Build the plugin: `npm run build`
2. Copy `main.js`, `manifest.json`, and `styles.css` to your vault:
   `VaultFolder/.obsidian/plugins/vectorize/`
3. Reload Obsidian
4. Enable "Vectorize" in Settings → Community Plugins

### First Time Setup
1. Open Settings → Vectorize
2. Verify Ollama model name (default: nomic-embed-text)
3. Verify Milvus address (default: localhost:19530)
4. Run "Recompute vectors for all notes" to index your vault
5. Use "Find similar notes" or "Query similar notes" commands

### How It Works
1. **Collection Creation**: Plugin creates a Milvus collection on first use
2. **Embedding Generation**: Ollama generates 768-dimensional vectors from note text
3. **Vector Storage**: Each note's embedding is stored with its file path and metadata
4. **Similarity Search**: Uses cosine similarity to find related notes
5. **Auto-Update**: Only reprocesses notes that have been modified

## Development Workflow

### Working on the Plugin
1. The "Build Plugin" workflow runs `npm run dev` automatically
2. Edit `main.ts` to modify plugin functionality
3. Changes auto-compile to `main.js`
4. Test in Obsidian by copying built files to your test vault

### Key Implementation Details
- **Milvus Collection Schema**: 768-dim vectors with file path, content preview, modified time
- **Search Algorithm**: AUTOINDEX with COSINE metric for similarity
- **Error Handling**: Comprehensive try-catch with user-friendly notices
- **Performance**: Batch processing with progress updates for large vaults
- **Memory Management**: Collection loaded on-demand, cached after first use

## Technical Notes
- This is a **plugin development environment**, not a standalone application
- The plugin must be loaded into Obsidian to function
- Requires local Ollama and Milvus services
- Built files (`main.js`) are auto-generated and excluded from git
- esbuild configured with `platform: 'node'` to support Node.js modules

## API References
- Obsidian API: https://github.com/obsidianmd/obsidian-api
- Ollama API: https://github.com/ollama/ollama-js
- Milvus Node SDK: https://milvus.io/api-reference/node/
