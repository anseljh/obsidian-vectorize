# Obsidian Vectorize Plugin

## Overview
Vectorize is an Obsidian plugin that enables semantic search across your notes using vector embeddings. It uses Ollama (running locally) to generate embeddings from note content and stores them in a Milvus vector database for fast similarity searches.

**Project Type:** Obsidian Plugin Development (TypeScript)
**Build System:** esbuild
**Package Manager:** npm
**Current State:** Fully implemented and ready for use

## Recent Changes
- **2025-10-26**: Added connection status indicators to settings
  - Added "Test Connection" buttons for both Ollama and Milvus
  - Real-time connection status with color-coded feedback
  - Verifies Ollama model availability and lists alternatives if missing
  - Reports Milvus collection existence status
- **2025-10-26**: Refactored to use browser-compatible HTTP APIs
  - Removed Node.js SDK dependencies (ollama, @zilliz/milvus2-sdk-node)
  - Implemented direct HTTP calls to Ollama API (/api/embed)
  - Implemented direct HTTP calls to Milvus RESTful API (v2)
  - Fixed Obsidian compatibility - plugin now works in Electron renderer
  - Bundle size reduced from 883KB to 13KB
  - Updated settings to include full URLs for services

## Plugin Features

### Core Functionality
1. **Embedding Generation**: Uses Ollama HTTP API to generate vector embeddings from note content
2. **Vector Storage**: Stores embeddings in Milvus vector database via RESTful API
3. **Similarity Search**: Find notes similar to the current note or custom queries
4. **Vector Management**: Refresh modified notes or recompute all vectors

### Commands
- **Find similar notes to current note**: Analyzes the active note and displays similar notes
- **Query similar notes**: Opens a dialog to search for notes similar to custom text
- **Refresh vectors for modified notes**: Updates embeddings only for notes that changed
- **Recompute vectors for all notes**: Rebuilds the entire vector database

### Settings
- **Ollama URL**: URL of Ollama server (default: http://localhost:11434)
- **Ollama Model**: Which model to use for embeddings (default: nomic-embed-text)
- **Ollama Connection Status**: Test button to verify Ollama connectivity and model availability
- **Milvus URL**: URL of Milvus server (default: http://localhost:19530)
- **Collection Name**: Name of the Milvus collection (default: obsidian_notes)
- **Milvus Connection Status**: Test button to verify Milvus connectivity and collection status

## Project Architecture

### File Structure
- `main.ts` - Plugin implementation with all features
- `main.js` - Compiled plugin (generated by esbuild)
- `manifest.json` - Plugin metadata
- `package.json` - Dependencies and scripts
- `esbuild.config.mjs` - Build configuration
- `tsconfig.json` - TypeScript compiler configuration

### Dependencies
- **No runtime dependencies** - Uses browser-compatible APIs only
- `obsidian` - Obsidian API types and interfaces (dev dependency)

### Build Process
- **Development**: `npm run dev` - Watches for changes and auto-compiles
- **Production**: `npm run build` - Type-checks and builds minified version
- **Platform**: Browser (default) - compatible with Obsidian's Electron renderer

## Usage Instructions

### Prerequisites
Before using this plugin, you need:
1. **Ollama** running locally on `http://localhost:11434`
2. **Milvus** vector database running on `http://localhost:19530`
3. The **nomic-embed-text** model installed in Ollama (or configure a different model)

### Installation
1. Build the plugin: `npm run build`
2. Copy `main.js`, `manifest.json`, and `styles.css` to your vault:
   `VaultFolder/.obsidian/plugins/vectorize/`
3. Reload Obsidian
4. Enable "Vectorize" in Settings → Community Plugins

### First Time Setup
1. Open Settings → Vectorize
2. Verify Ollama URL (default: http://localhost:11434)
3. Verify Ollama model name (default: nomic-embed-text)
4. Verify Milvus URL (default: http://localhost:19530)
5. Run "Recompute vectors for all notes" to index your vault
6. Use "Find similar notes" or "Query similar notes" commands

### How It Works
1. **Collection Creation**: Plugin creates a Milvus collection on first use via RESTful API
2. **Embedding Generation**: Ollama generates 768-dimensional vectors from note text via HTTP
3. **Vector Storage**: Each note's embedding is stored with its file path and metadata
4. **Similarity Search**: Uses cosine similarity to find related notes
5. **Auto-Update**: Only reprocesses notes that have been modified

## Development Workflow

### Working on the Plugin
1. The "Build Plugin" workflow runs `npm run dev` automatically
2. Edit `main.ts` to modify plugin functionality
3. Changes auto-compile to `main.js`
4. Test in Obsidian by copying built files to your test vault

### Key Implementation Details
- **Browser-Compatible**: Uses Obsidian's `requestUrl()` for all HTTP requests
- **Ollama Integration**: Direct HTTP calls to `/api/embed` endpoint
- **Milvus Integration**: Uses RESTful API v2 endpoints
- **No Node.js Dependencies**: Works in Obsidian's Electron renderer environment
- **Milvus Collection Schema**: 768-dim vectors with file path, content preview, modified time
- **Search Algorithm**: COSINE metric for similarity
- **Error Handling**: Comprehensive try-catch with user-friendly notices
- **Performance**: Batch processing with progress updates for large vaults

## Technical Notes
- This is a **plugin development environment**, not a standalone application
- The plugin must be loaded into Obsidian to function
- Requires local Ollama and Milvus services
- Built files (`main.js`) are auto-generated and excluded from git
- Uses browser-compatible APIs only (no Node.js modules)
- Small bundle size (13KB) due to no external dependencies

## API References
- Obsidian API: https://github.com/obsidianmd/obsidian-api
- Ollama HTTP API: https://github.com/ollama/ollama/blob/main/docs/api.md
- Milvus RESTful API: https://milvus.io/api-reference/restful/v2.6.x/About.md
